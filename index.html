<!doctype html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Palermo incidenti stradali dal 2015 al 2023 - Dashboard by @opendatasicilia</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <META HTTP-EQUIV="refresh" CONTENT="3600">  
    <meta name="description" content="Dashboard interattiva degli incidenti stradali a Palermo">
    <meta name="keywords" content="Open Data, Sicilia, Palermo, Incidenti Stradali">
    <meta name="author" content="Giovan Battista Vitrano per OpenDataSicilia.it">
    
    <link rel="shortcut icon" href="favicon.ico"/> 
    <link rel="icon" href="favicon.png" type="image/png"/> 
    <!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" rel="stylesheet">
       <link rel="stylesheet" href="css/incidenti.css">
	   <link rel="stylesheet" href="css/footer-modal.css">
    
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    
    <style>
        .demo-badge {
            position: absolute;
    top: 50px;
    right: -25px;
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            transform: rotate(-30deg);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
            animation: pulse-demo 2s ease-in-out infinite;
            z-index: 10;
        }
        
        .demo-badge i {
            margin-right: 4px;
            font-size: 12px;
        }
        
        @keyframes pulse-demo {
            0%, 100% {
                transform: rotate(-30deg) scale(1);
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
            }
            50% {
                transform: rotate(-30deg) scale(1.05);
                box-shadow: 0 6px 16px rgba(239, 68, 68, 0.6);
            }
        }
        
        .header-content {
            position: relative;
        }
    </style>
</head>
<body>
    <!-- Mobile Toggle -->
    <button class="mobile-toggle" id="mobile-toggle">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    
    <!-- Sidebar -->
    <div id="sidebar">
        <div class="header">
            <div class="header-content">
                <h1>Incidenti Stradali</h1>
                <p>Palermo 2015-2023 • Dashboard Interattiva</p>
                <span class="demo-badge">
                    <i class="fas fa-flask"></i> Demo Version
                </span>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat-label-main">Statistiche</div>
            <div class="stat-grid">
                <div class="stat-item mortale">
                    <div class="stat-label">Mortali</div>
                    <div class="stat-value" id="stat-mortale">0</div>
                </div>
                <div class="stat-item riserva">
                    <div class="stat-label">Riserva</div>
                    <div class="stat-value" id="stat-riserva">0</div>
                </div>
                <div class="stat-item feriti">
                    <div class="stat-label">Feriti</div>
                    <div class="stat-value" id="stat-feriti">0</div>
                </div>
                <div class="stat-item cose">
                    <div class="stat-label">Cose</div>
                    <div class="stat-value" id="stat-cose">0</div>
                </div>
            </div>
            <div class="stat-total">
                <div class="stat-label">Totale Incidenti</div>
                <div class="stat-value" id="stat-total">0</div>
                <div class="stat-info" id="total-info">
                    <span><i class="fas fa-check"></i> Dati caricati</span>
                    <span class="info-icon" id="info-icon-btn" title="Informazioni sui dati">i</span>
                </div>
            </div>
            
            <div class="year-stats">
                <div class="year-stats-title"><i class="fas fa-chart-bar"></i> Distribuzione per Anno (clicca per filtrare)</div>
                <div class="year-stats-grid" id="year-stats-grid"></div>
            </div>
        </div>

        <div class="filters">
            <button class="btn-heatmap" id="btn-toggle-heatmap">
                <i class="fas fa-fire"></i> Mappa di Calore
            </button>
            <br>
            <div class="filter-group hidden">
                <label class="filter-label">Tipologia Incidente</label>
                <select id="filter-tipologia">
                    <option value="">Tutte le tipologie</option>
                    <option value="M">M - Mortale</option>
                    <option value="R">R - Riserva</option>
                    <option value="F">F - Feriti</option>
                    <option value="C">C - Cose</option>
                </select>
            </div>
           <div class="filter-section">
<!-- NUOVO: Sezione Calendario Personalizzato -->
<div class="filter-section" >
    <div class="filter-section-header" data-section="calendario">
        <span><i class="fas fa-calendar-alt"></i> Calendario Interattivo</span>
        <span class="toggle-icon collapsed"><i class="fas fa-chevron-down"></i></span>
    </div>
    <div class="filter-section-content collapsed" id="content-calendario">
        <div class="custom-calendar" id="custom-calendar">
            <!-- Controlli Anno -->
            <div class="calendar-year-control">
                <button class="calendar-nav-btn" id="cal-prev-year"><i class="fas fa-chevron-left"></i></button>
                <div class="calendar-year-display" id="cal-year-display">2023</div>
                <button class="calendar-nav-btn" id="cal-next-year"><i class="fas fa-chevron-right"></i></button>
            </div>
            
            <!-- Griglia Mesi -->
            <div class="calendar-months-grid" id="cal-months-grid">
                <!-- Sarà popolato via JS -->
            </div>
            
            <!-- Griglia Giorni Settimana -->
            <div class="calendar-weekdays-grid" id="cal-weekdays-grid">
                <!-- Sarà popolato via JS -->
            </div>
            
            <!-- Griglia Giorni del Mese (quando un mese è selezionato) -->
            <div class="calendar-days-container" id="cal-days-container" style="display: none;">
                <div class="calendar-month-header" id="cal-month-header"></div>
                <div class="calendar-weekday-labels">
                    <div>L</div><div>M</div><div>M</div><div>G</div><div>V</div><div>S</div><div>D</div>
                </div>
                <div class="calendar-days-grid" id="cal-days-grid">
                    <!-- Sarà popolato via JS -->
                </div>
            </div>
            
            <!-- Riepilogo Selezione -->
            <div class="calendar-selection-summary" id="cal-selection-summary">
                Nessun filtro temporale attivo
            </div>
            
            <!-- Pulsanti Azione -->
            <div class="calendar-actions">
                <button class="btn-calendar-reset" id="btn-calendar-reset"><i class="fas fa-sync-alt"></i> Reset</button>
            </div>
        </div>
    </div>
</div>
                <div class="filter-section-header" data-section="localizzazione">
                    <span><i class="fas fa-map-marker-alt"></i> Localizzazione</span>
                    <span class="toggle-icon collapsed"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="filter-section-content collapsed" id="content-localizzazione">
                    <div class="filter-group">
                        <label class="filter-label">Circoscrizioni</label>
                        <select id="filter-circoscrizione"></select>
                        <div class="filter-cascade-info">Filtra Quartiere e UPL <i class="fas fa-arrow-down"></i></div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Quartieri</label>
                        <select id="filter-quartiere"></select>
                        <div class="filter-cascade-info">Filtra UPL <i class="fas fa-arrow-down"></i></div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Unità di primo livello</label>
                        <select id="filter-upl"></select>
                    </div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-section-header" data-section="temporale">
                    <span><i class="fa-solid fa-calendar"></i> Analisi Temporale</span>
                    <span class="toggle-icon collapsed"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="filter-section-content collapsed" id="content-temporale">
                    <div class="filter-group hidden">
                        <label class="filter-label">Anno</label>
                        <select id="filter-anno"></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Stagione</label>
                        <select id="filter-stagione"></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Mese</label>
                        <select id="filter-mese"></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Giorno Settimana</label>
                        <select id="filter-giorno-settimana"></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Feriale/Weekend</label>
                        <select id="filter-feriale-weekend"></select>
                    </div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-section-header" data-section="condizioni">
                    <span><i class="fas fa-cloud-sun"></i> Condizioni e Orari</span>
                    <span class="toggle-icon collapsed"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="filter-section-content collapsed" id="content-condizioni">
                    <div class="filter-group">
                        <label class="filter-label">Giorno/Notte</label>
                        <select id="filter-giorno-notte"></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Condizioni Luce</label>
                        <select id="filter-condizioni-luce"></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Fascia Oraria (4 fasce)</label>
                        <select id="filter-fascia-4"></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Fascia Oraria (6 fasce)</label>
                        <select id="filter-fascia-6"></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ora di Punta</label>
                        <select id="filter-ora-punta"></select>
                    </div>
                </div>
            </div>

            <button class="btn-reset" id="btn-reset" title="Reset Filtri"><i class="fas fa-sync-alt"></i> Reset Filtri</button>
            <button class="btn-data-table" id="btn-data-table" title="Visualizza e scarica i dati selezionati"><i class="fas fa-table"></i> Tabella Dati</button>
            <a href="https://www.dati.gov.it/view-dataset?Cerca=incidenti+palermo" title="Agenzia per l'Italia Digitale" target="_blank" rel="noopener noreferrer" class="btn-fonte">
                <i class="fa fa-database"></i> Fonte Dati: dati.gov.it
            </a>
        </div>
    </div>

    <!-- Map -->
    <div id="map"></div>
    
    <!-- Map Controls Container -->
    <div class="map-controls-container">
   </div>

<!-- Analytics Side Panel -->
<div id="analytics-side-panel">
    <!-- Sezione 1: Controlli Mappa -->
   <div class="panel-section section-map-controls">
    <div class="section-header">
        <i class="fas fa-map"></i>
        <span>Controlli Mappa</span>
    </div>
    <div class="section-content">
        <select id="basemap-select" class="panel-select" title="Seleziona Mappa di Base">
            <option value="carto-light" selected>Carto Light</option>
            <option value="carto-dark">Carto Dark</option>
            <option value="osm">OpenStreetMap</option>
            <option value="satellite">Satellite</option>
        </select>
                <!-- Pulsanti affiancati -->
        <div class="panel-btn-row">
        <button class="panel-btn btn-primary" id="btn-clustering-map" title="Visualizza clustering geografico">
            <i class="fas fa-circle"></i>
            <span>Clustering</span>
        </button>
        
        <button class="panel-btn btn-warning" id="btn-top-luoghi-map" style="display: none;" title="Top 25 vie">
            <i class="fas fa-trophy"></i>
            <span>Top Luoghi</span>
        </button>
        
        <button class="panel-btn btn-success" id="btn-heatmap-map" title="Mappa di calore">
            <i class="fas fa-fire"></i>
            <span>Heatmap</span>
        </button>
        </div>
        <!-- Pulsanti affiancati -->
        <div class="panel-btn-row">
            <button class="panel-btn btn-info" id="btn-data-table-map" title="Tabella dati">
                <i class="fas fa-table"></i>
                <span>Tabella</span>
            </button>
            
            <button class="panel-btn btn-purple" id="btn-analytics-map" title="Dashboard analisi">
                <i class="fas fa-chart-line"></i>
                <span>Analisi</span>
            </button>
        </div>
					            <button class="panel-btn btn-danger" id="btn-reset-map" title="Reset Filtri">
                <i class="fas fa-sync-alt"></i>
                <span>Reset Filtri</span>
            </button>
    </div>
</div>

    <!-- Sezione 2: Tipologie Incidenti -->
    <div class="panel-section section-types">
        <div class="section-header">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="legend-chart-title">Tipologie Incidenti</span>
        </div>
        <div class="section-content">
            <div class="chart-wrapper-panel">
                <canvas id="legend-chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Sezione 3: Periodo Giorno/Notte -->
    <div class="panel-section section-period">
        <div class="section-header">
            <i class="fas fa-sun"></i>
            <i class="fas fa-moon"></i>
            <span>Periodo</span>
        </div>
        <div class="section-content">
            <div class="period-switches">
                <button id="switch-giorno" class="period-switch" data-period="Giorno" title="Filtra incidenti diurni">
                    <i class="fas fa-sun"></i>
                    <span>Giorno</span>
                    <span id="count-giorno" class="period-count">0</span>
                </button>
                <button id="switch-notte" class="period-switch" data-period="Notte" title="Filtra incidenti notturni">
                    <i class="fas fa-moon"></i>
                    <span>Notte</span>
                    <span id="count-notte" class="period-count">0</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Sezione 4: Analisi Mensile -->
    <div class="panel-section section-monthly">
        <div class="section-header">
            <i class="fas fa-chart-bar"></i>
            <span>Incidenti per Mese</span>
        </div>
        <div class="section-content">
            <div class="chart-wrapper-panel">
                <canvas id="monthly-area-chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Sezione 5: Analisi Feriti/Morti -->
    <div class="panel-section section-injuries">
        <div class="section-header">
            <i class="fas fa-ambulance"></i>
            <span>Feriti/Morti per Mese</span>
        </div>
        <div class="section-content">
            <div class="chart-wrapper-panel">
                <canvas id="monthly-injuries-chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Sezione 6: Azioni 
    <div class="panel-section section-actions">
        <div class="section-content">
            <button class="panel-btn btn-danger" id="btn-reset-map" title="Reset Filtri">
                <i class="fas fa-sync-alt"></i>
                <span>Reset Filtri</span>
            </button>
         </div>-->
    </div>
</div>

<!-- Heatmap Legend (separato, si mostra solo con heatmap attiva) -->
<div class="heatmap-legend hidden" id="heatmap-legend">
    <h3>Densità Incidenti</h3>
    <div class="heatmap-gradient"></div>
    <div class="heatmap-labels">
        <span>Bassa</span>
        <span>Alta</span>
    </div>
</div>


   <!-- Heatmap Legend -->
    <div class="heatmap-legend hidden" id="heatmap-legend">
        <h3>Densità Incidenti</h3>
        <div class="heatmap-gradient"></div>
        <div class="heatmap-labels">
            <span>Bassa</span>
            <span>Alta</span>
        </div>
    </div>

    <!-- Loading -->
    <div class="loading" id="loading">
        <div>Caricamento dati CSV...</div>
        <small>Attendere prego</small>
    </div>

    <!-- Detail Panel -->
    <div class="detail-panel" id="detail-panel">
        <div class="detail-header">
            <button class="detail-close" id="detail-close">×</button>
            <h2 id="detail-tipo-header">
                <span id="detail-tipo-icon"><i class="fas fa-car"></i></span>
                Dettagli Incidente
            </h2>
            <p id="detail-subtitle">Informazioni complete</p>
        </div>
        <div class="detail-content" id="detail-content"></div>
    </div>

    <!-- Info Modal -->
    <div class="modal" id="info-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> Informazioni sui Dati</h3>
                <button class="modal-close" id="info-modal-close">×</button>
            </div>
            <div class="modal-body">
                <p><strong>Dataset completo:</strong> 28.239 incidenti registrati a Palermo dal 2015 al 2023.</p>
                <p><strong>Incidenti mappati:</strong> 23.487 incidenti (83,2% del totale) con coordinate geografiche valide.</p>
                <p><strong>Esclusioni:</strong></p>
                <ul style="margin-left: 20px; margin-bottom: 16px;">
                    <li style="margin-bottom: 8px;"><strong>1.560 incidenti (5,5%)</strong> - Coordinate esterne ai confini comunali</li>
                    <li><strong>3.192 incidenti del 2019 (11,3%)</strong> - Privi di coordinate geografiche</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Data Table Modal -->
    <div class="modal" id="data-table-modal">
        <div class="modal-content" style="max-width: 90vw;">
            <div class="modal-header">
                <h3><i class="fas fa-table"></i> Tabella Dati Incidenti Filtrati</h3>
                <button class="modal-close" id="data-table-close">×</button>
            </div>
            <div class="modal-body">
                <div class="table-actions">
                    <button class="btn-download" id="btn-download-csv"><i class="fas fa-download"></i> Scarica CSV</button>
                    <button class="btn-download" id="btn-download-json"><i class="fas fa-download"></i> Scarica JSON</button>
                </div>
                <div style="color: #94a3b8; font-size: 12px; margin-bottom: 12px;">
                    <strong id="table-count">0</strong> incidenti visualizzati
                </div>
                <div class="table-container">
                    <table class="data-table" id="data-table">
                        <thead id="table-header"></thead>
                        <tbody id="table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Panel -->
    <div class="analytics-panel" id="analytics-panel">
        <div class="analytics-header">
            <div class="analytics-header-top">
                <h2><i class="fas fa-chart-line"></i> Analisi Avanzata Incidenti</h2>
                <button class="analytics-close" id="analytics-close">×</button>
            </div>
            <div class="analytics-filters-info" id="analytics-filters-info">
                <strong>Dati Visualizzati:</strong>
                <span id="active-filters-text">Tutti gli incidenti (2015-2023)</span>
            </div>
        </div>
        
        <div class="analytics-tabs">
            <button class="analytics-tab active" data-tab="panoramica"><i class="fas fa-chart-bar"></i> Panoramica</button>
            <button class="analytics-tab" data-tab="temporale"><i class="fas fa-calendar-alt"></i> Temporale</button>
            <button class="analytics-tab" data-tab="oraria"><i class="fas fa-clock"></i> Oraria</button>
            <button class="analytics-tab" data-tab="condizioni"><i class="fas fa-cloud-sun"></i> Condizioni</button>
            <button class="analytics-tab" data-tab="insights"><i class="fas fa-lightbulb"></i> Insights</button>
        </div>

        <div class="analytics-content">
            <!-- Panoramica Tab -->
            <div class="analytics-tab-content active" id="tab-panoramica">
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Trend Annuale Incidenti</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-trend-annuale"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>Distribuzione per Tipologia</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-tipologia"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>Analisi Stagionale</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-stagionale"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>Feriale vs Weekend</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-feriale-weekend"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Temporale Tab -->
            <div class="analytics-tab-content" id="tab-temporale">
                <div class="charts-grid">
                    <div class="chart-container chart-full">
                        <h3>Distribuzione per Giorno della Settimana</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-giorno-settimana"></canvas>
                        </div>
                    </div>
                    <div class="chart-container chart-full">
                        <h3>Evoluzione Annuale (Feriti vs Non Feriti)</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-evoluzione-anni"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Oraria Tab -->
            <div class="analytics-tab-content" id="tab-oraria">
                <div class="charts-grid">
                    <div class="chart-container chart-full">
                        <h3>Distribuzione per Fascia Oraria</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-fascia-oraria"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>Top 3 Fasce per Incidenti</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-top-incidenti"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>Top 3 Fasce per Feriti</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-top-feriti"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Condizioni Tab -->
            <div class="analytics-tab-content" id="tab-condizioni">
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Luce vs Buio</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-luce-buio"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>Dettaglio Condizioni Luce</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-condizioni-dettaglio"></canvas>
                        </div>
                    </div>
                    <div class="chart-container chart-full">
                        <h3>Confronto Stagionale delle Condizioni</h3>
                        <div class="chart-wrapper">
                            <canvas id="chart-stagioni-condizioni"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insights Tab -->
            <div class="analytics-tab-content" id="tab-insights">
                <div class="insights-container">
                    <div class="stats-realtime">
                        <h3><i class="fas fa-chart-bar"></i> Statistiche in Tempo Reale</h3>
                        <div class="stats-realtime-grid">
                            <div class="stat-realtime-item">
                                <div class="stat-realtime-label">Totale Incidenti</div>
                                <div class="stat-realtime-value" id="realtime-total">0</div>
                            </div>
                            <div class="stat-realtime-item">
                                <div class="stat-realtime-label">Totale Feriti</div>
                                <div class="stat-realtime-value" id="realtime-feriti">0</div>
                            </div>
                            <div class="stat-realtime-item">
                                <div class="stat-realtime-label">% con Feriti</div>
                                <div class="stat-realtime-value" id="realtime-percentuale">0%</div>
                            </div>
                            <div class="stat-realtime-item">
                                <div class="stat-realtime-label">Media Feriti</div>
                                <div class="stat-realtime-value" id="realtime-media">0</div>
                            </div>
                        </div>
                    </div>

                    <div class="insights-auto">
                        <h3><i class="fas fa-lightbulb"></i> Insights Automatici</h3>
                        <div class="insight-item">
                            <div class="insight-icon"><i class="fas fa-calendar-day"></i></div>
                            <div class="insight-content">
                                <div class="insight-label">Giorno più pericoloso</div>
                                <div class="insight-value" id="insight-giorno">-</div>
                            </div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-icon"><i class="fas fa-clock"></i></div>
                            <div class="insight-content">
                                <div class="insight-label">Fascia oraria critica</div>
                                <div class="insight-value" id="insight-fascia">-</div>
                            </div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-icon"><i class="fas fa-leaf"></i></div>
                            <div class="insight-content">
                                <div class="insight-label">Stagione più rischiosa</div>
                                <div class="insight-value" id="insight-stagione">-</div>
                            </div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-icon"><i class="fas fa-moon"></i></div>
                            <div class="insight-content">
                                <div class="insight-label">Condizione più pericolosa</div>
                                <div class="insight-value" id="insight-condizione">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- Top Luoghi Modal -->
<div class="modal" id="top-luoghi-modal">
    <div class="modal-content" style="max-width: 1000px;">
        <div class="modal-header">
            <h3><i class="fas fa-trophy"></i> Top 25 vie con più incidenti</h3>
            <button class="modal-close" id="top-luoghi-close">×</button>
        </div>
        <div class="modal-body">
            <div class="table-actions">
                <button class="btn-download" id="btn-download-luoghi-csv">Scarica CSV</button>
                <div style="color: #94a3b8; font-size: 12px;">
                    <strong id="top-luoghi-count">0</strong> luoghi analizzati
                </div>
            </div>
            <div class="table-container">
                <table class="data-table" id="top-luoghi-table">
                    <thead>
                        <tr>
                            <th style="width: 60px;">#</th>
                            <th>Indirizzo</th>
                            <th style="width: 100px;">Totale</th>
                            <th style="width: 80px;">Mortali</th>
                            <th style="width: 80px;">Riserva</th>
                            <th style="width: 80px;">Feriti</th>
                            <th style="width: 80px;">Cose</th>
                            <th style="width: 120px;">Azioni</th>
                        </tr>
                    </thead>
                    <tbody id="top-luoghi-body"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- Footer Button with Pulse -->
<button class="footer-info-btn" id="footer-info-btn">
    <span class="pulse-ring"></span>
    <i class="fas fa-info-circle"></i>
    Informazioni
</button>

<!-- Footer Modal Panel -->
<div class="footer-modal" id="footer-modal">
    <div class="footer-modal-header">
        <h3><i class="fas fa-chart-bar"></i> Informazioni Dataset</h3>
        <button class="footer-modal-close" id="footer-modal-close">×</button>
    </div>
    
    <div class="footer-modal-tabs">
        <button class="footer-tab active" data-tab="dataset">Dataset</button>
        <button class="footer-tab" data-tab="fonte">Fonte Dati</button>
        <button class="footer-tab" data-tab="licenza">Licenza</button>
	 <button class="footer-tab" data-tab="tecnologie">Tecnologie</button>
        <button class="footer-tab" data-tab="crediti">Crediti</button>
		
    </div>
    
    <div class="footer-modal-content">
	    <button class="back-to-top-btn" id="back-to-top-btn" title="Torna su">
        <i class="fas fa-arrow-up"></i>
    </button>
        <!-- Tab Dataset -->
        <div class="footer-tab-content active" id="tab-dataset">
            <div class="info-card">
                <h4><i class="fas fa-chart-line"></i> Statistiche Dataset</h4>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Periodo coperto</span>
                        <span class="info-value">2015 - 2023</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Totale incidenti</span>
                        <span class="info-value">28.239</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Incidenti mappati</span>
                        <span class="info-value">23.487 (83,2%)</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Ultimo aggiornamento</span>
                        <span class="info-value">Dicembre 2023</span>
                    </div>
                </div>
                <div class="info-note">
                    <strong><i class="fas fa-exclamation-triangle"></i> Note importanti:</strong>
                    <ul>
                        <li>1.560 incidenti con coordinate esterne ai confini comunali (esclusi)</li>
                        <li>3.192 incidenti del 2019 senza coordinate geografiche (conteggiati ma non visualizzati)</li>
                    </ul>
                </div> <i class="fa-solid fa-square-binary"></i>
            </div>
        </div>
        
        <!-- Tab Fonte Dati -->
        <div class="footer-tab-content" id="tab-fonte">
            <div class="info-card">
                <h4><i class="fa fa-database"></i> Fonte dei Dati</h4>
                <p><strong>Ente:</strong> Comune di Palermo - Polizia Municipale</p>
                <p><strong>Portale:</strong> <a href="https://www.dati.gov.it/view-dataset?Cerca=incidenti+palermo" target="_blank" rel="noopener">dati.gov.it</a></p>
                <p><strong>Dataset:</strong> Incidenti stradali rilevati dalla Polizia Municipale di Palermo</p>
                <div class="info-note">
                    <strong><i class="fas fa-clipboard-list"></i> Contenuto del dataset:</strong>
                    <p>Il dataset contiene informazioni dettagliate su ogni incidente stradale rilevato, inclusi: tipologia, data, ora, condizioni atmosferiche, visibilità, localizzazione geografica e amministrativa.</p>
                </div>
            </div>
        </div>
        
        <!-- Tab Licenza -->
        <div class="footer-tab-content" id="tab-licenza">
            <div class="info-card">
                <h4><i class="fas fa-balance-scale"></i> Licenza d'Uso</h4>
                <p><strong>Licenza:</strong> Creative Commons - Attribuzione 4.0 Internazionale (CC BY 4.0)</p>
                <div class="license-box">
                    <p><strong>Sei libero di:</strong></p>
                    <ul>
                        <li><i class="fas fa-check"></i> Condividere – riprodurre, distribuire, comunicare al pubblico</li>
                        <li><i class="fas fa-check"></i> Modificare – rielaborare e trasformare i dati</li>
                        <li><i class="fas fa-check"></i> Utilizzare per fini commerciali</li>
                    </ul>
                    <p><strong>Alle seguenti condizioni:</strong></p>
                    <ul>
                        <li><i class="fas fa-pencil-alt"></i> Attribuzione – devi riconoscere la paternità dei dati e fornire un link alla licenza</li>
                    </ul>
                </div>
                <p style="margin-top: 16px;"><a href="https://creativecommons.org/licenses/by/4.0/deed.it" target="_blank" rel="noopener">Leggi il testo completo della licenza <i class="fas fa-external-link-alt"></i></a></p>
            </div>
        </div>
		
        <!-- Tab tecnologie -->
        <div class="footer-tab-content" id="tab-tecnologie">
            <div class="info-card">
                <h4><i class="fas fa-map"></i> Tecnologie utilizzate</h4>
<p><strong>In sintesi:</strong></p>
                    <ul>
					<li>QGIS - software libero e open source per i Sistemi Informativi Geografici (GIS), che permette di visualizzare, organizzare, analizzare e rappresentare dati spaziali</li>
                        <li>MapLibre GL JS - Visualizzazione mappa interattiva</li>
                        <li>Chart.js - Grafici e visualizzazioni dati</li>
                        <li>PapaParse - Elaborazione file CSV</li>
                    </ul><br>
					<hr><br>
				<p><strong>Versione estesa:</strong></p>
				<p>Questa web app utilizza uno stack tecnologico <strong>completamente client-side</strong> (nessun backend), basato su tecnologie web moderne:</p>

<h4>Frontend Core</h4>
<ul>
  <li><strong>HTML5</strong> - Struttura semantica della pagina</li>
  <li><strong>CSS3</strong> - Styling avanzato con gradients, flexbox, grid, animazioni</li>
  <li><strong>JavaScript ES6+</strong> - Logica applicativa (vanilla JS, no framework)</li>
</ul>

<h4>Librerie JavaScript</h4>
<ul>
  <li><strong>MapLibre GL JS</strong> (v4.7.1) - Rendering mappe vettoriali WebGL
    <ul>
      <li>Alternative open-source a Mapbox</li>
      <li>Supporto tile raster e stili personalizzati</li>
    </ul>
  </li>
  <li><strong>PapaParse</strong> (v5.4.1) - Parsing CSV lato client
    <ul>
      <li>Gestione file grandi con streaming</li>
    </ul>
  </li>
  <li><strong>Chart.js</strong> (v4.4.0) - Visualizzazioni dati interattive
    <ul>
      <li>Plugin: ChartDataLabels per etichette sui grafici</li>
    </ul>
  </li>
</ul>

<h4>Fonti Dati</h4>
<ul>
  <li><strong>Tile Maps</strong>: CartoDB, OpenStreetMap, Google Satellite</li>
  <li><strong>CSV statico</strong>: <code>incidenti_2015_2023.csv</code> (23.487 record geocodificati)</li>
  <li>Nessun database - tutto caricato in memoria browser</li>
</ul>

<h4>Pattern Architetturali</h4>
<ul>
  <li><strong>Single Page Application (SPA)</strong> - Nessun reload pagina</li>
  <li><strong>Component-based</strong> - Pannelli modulari (sidebar, analytics, dettagli)</li>
  <li><strong>Event-driven</strong> - Listener per filtri, click mappa, interazioni UI</li>
  <li><strong>State management</strong> - Oggetti globali (<code>currentFilters</code>, <code>customCalendarState</code>)</li>
</ul>

<h4>Caratteristiche Tecniche</h4>
<ul>
  <li><strong>Responsive Design</strong> - Media queries per mobile/tablet/desktop</li>
  <li><strong>Touch-optimized</strong> - Gesture handler per dispositivi touch</li>
  <li><strong>Client-side filtering</strong> - Nessuna query server, filtraggio array in-memory</li>
  <li><strong>Real-time updates</strong> - Sincronizzazione immediata tra filtri/mappa/grafici</li>
</ul>

<h4>Performance</h4>
<ul>
  <li><strong>Lazy rendering</strong> - Solo dati visibili renderizzati</li>
  <li><strong>Clustering geografico</strong> - SuperCluster per aggregazione punti</li>
  <li><strong>Debouncing</strong> - Eventi touch ottimizzati</li>
  <li><strong>Canvas rendering</strong> - Chart.js usa canvas per performance</li>
</ul>

<h4>Deployment</h4>
<ul>
  <li><strong>Static hosting</strong> - Può girare su GitHub Pages, Netlify, CDN</li>
  <li><strong>No build step</strong> - File serviti direttamente (no webpack/vite necessari)</li>
</ul>

<p>È essenzialmente una <strong>Progressive Web App</strong> che sfrutta le capacità moderne dei browser per elaborare e visualizzare grandi dataset senza server.</p>
            </div>
        </div>

        <!-- Tab Crediti -->
        <div class="footer-tab-content" id="tab-crediti">
            <div class="info-card">
                <h4><i class="fas fa-users"></i> Crediti e Realizzazione</h4>
                <div class="credits-section">
                    <p><strong><i class="fas fa-tools"></i> Sviluppo e Design:</strong></p>
                    <p>Applicazione web a tecnologia ibrida, sviluppata attraverso una collaborazione human-<a href="https://claude.ai" target="_blank">Claude AI (Anthropic)</a>, che ha supportato lo sviluppo dell'architettura modulare, l'ottimizzazione del codice e l'implementazione di funzionalità avanzate di visualizzazione.<strong>Rielaborazione dati & Autore:</strong> <a href="https://www.linkedin.com/in/gbvitrano/" target="_blank" rel="noopener">Giovan Battista Vitrano</a></p>
                    
                    <p><strong><i class="fas fa-landmark"></i> Comunità:</strong></p>
                    <p><a href="http://opendatasicilia.it/" target="_blank" rel="noopener">OpenDataSicilia</a> - Comunità civica che promuove la cultura dei dati aperti in Sicilia</p>
                    
                    <p><strong><p> <i class="fas fa-heart"></i> Ringraziamenti:</strong></p>
					<p>Un grazie speciale a <a href="https://www.linkedin.com/in/andreaborruso/" title="Andrea Borruso" target="_blank">Andrea Borruso</a> e <a href="https://www.linkedin.com/in/salvatore-fiandaca-23a1a250/" title="Totò Fiandaca" target="_blank">Totò Fiandaca</a> per il prezioso supporto tecnico, per la loro disponibilità e per aver condiviso con generosità competenze ed esperienza.</p>
                                      
                    <p><strong><i class="fas fa-envelope"></i> Contatti:</strong></p>
                    <p>Per segnalazioni, suggerimenti o collaborazioni: <a href="https://groups.google.com/g/opendatasicilia?pli=1" target="_blank" rel="noopener">contattaci</a></p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="footer-modal-overlay" id="footer-modal-overlay"></div>
<script src="js/incidenti_smart-awesome.js"></script>
<script src="js/incidenti_final.js"></script>
<script src="js/footer-modal.js"></script>
</body>
</html>